# c#闭包问题--踩过的一个大坑

闭包的概念
Q：先抛出第一个问题，什么是闭包？闭包会出现在怎样的场景中？
A：在c#中，闭包是这样定义的：内层的函数可以引用包含在它外层的函数的变量，即使外层函数的执行已经终止。但该变量提供的值并非变量创建时的值，而是在父函数范围内的最终值。闭包主要用在访问外层函数定义的变量上。
     那么问题来了，笔者之前是学c和c++的，闭包的概念第一次接触，很懵逼。怎么办？继续查资料啊，笔者发现，闭包的概念首次提出是在Python语言中的，Python语言有一个很奇怪的地方，他可以嵌套定义函数，我们可以在定义函数a的时候，在a的内部定义函数b，且函数b只在函数a中有效。这就很神奇了，因为据笔者所知，c++和c是不支持函数嵌套定义的，只是支持函数的嵌套调用。嵌套定义和嵌套调用有个很大的区别，即嵌套定义中，内部函数可以访问其外部函数的作用域，但是外部函数不能访问内部函数的作用域。而c++中每个函数只可以使用自己内部栈中存储的局部变量、由入参传入的参数以及全局变量。Python中的函数嵌套定义的优势是能够对复杂代码进行划片，使得单个函数只实现单个功能，而且内部函数可以减少私有函数的定义；但是会使得函数间的耦合性增大。
     基于函数嵌套定义的需求，Python引入了闭包的概念。闭包（Closure）是词法闭包的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。这样的说法可能有些晦涩难懂，相信读者看了下面的例子应该就能对闭包的概念有个比较鲜明的认识了。
